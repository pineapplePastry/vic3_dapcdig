REPLACE:da_change_culture = { #from 53_subjects_change_culture in common\diplomatic_actions
	groups= { overlord }

	requires_approval = no
	should_notify_third_parties = yes
	show_effect_in_tooltip = yes

	texture = "gfx/interface/icons/diplomatic_action_icons/change_culture.dds"
	#confirmation_sound = "event:/SFX/UI/MapInteraction/SubjectInteractions/diplomatic_action_subjects_04_appoint_governor_benign"
	selectable = {
		has_dlc_feature = subject_and_bloc_actions
	}

	potential = {
		scope:target_country = {
			NOT = { is_diplomatic_play_enemy_of = root }
		}
	}

	possible = {
		NOT = {
			scope:target_country = {
				any_primary_culture = {
					OR = {
						shares_language_trait_with_any_primary_culture = ROOT
						is_primary_culture_of = ROOT
					}
				}
			}
		}
		is_revolutionary = no
		scope:target_country = {
			is_revolutionary = no
			has_law = law_type:law_colonial_administration
		}
	}

	accept_effect = {

		root.religion = { save_scope_as = digcf_conversion_target } #This is for the Devout IG Conversion Framework 

		scope:target_country = {
			capital = {
				save_temporary_scope_as = colonial_capital_scope
			}
			every_primary_culture = {
				prev = {
					add_radicals = {
						value = large_radicals
						culture = prev
					}
					remove_primary_culture = prev
				}
			}
		}
		### Special Cases
		# Special cases thus far:
		# 1. Canada getting either Anglo-Canadian or Franco-Canadian cultures
		# 2. South Africa getting Boer cultures
		if = {
			limit = {
				scope:target_country = {
					country_is_canadian = yes
				}
				any_primary_culture = {
					OR = {
						has_discrimination_trait = language_anglophone
						has_discrimination_trait = language_francophone
					}
				}
			}
			if = {
				limit = {
					ROOT = {
						any_primary_culture = {
							has_discrimination_trait = language_anglophone
						}
					}
				}
				cu:anglo_canadian = {
					save_scope_as = main_culture_scope
				}
				scope:target_country = {
					add_primary_culture = cu:anglo_canadian
				}
			}
			else_if = {
				limit = {
					ROOT = {
						any_primary_culture = {
							has_discrimination_trait = language_francophone
						}
					}
				}
				cu:franco_canadian = {
					save_scope_as = main_culture_scope
				}
				scope:target_country = {
					add_primary_culture = cu:franco_canadian
				}
			}
		}
		else_if = {
			limit = {
				scope:target_country = {
					c:SAF ?= this
				}
				any_primary_culture = {
					has_discrimination_trait = language_dutch
				}
			}
			if = {
				limit = {
					ROOT = {
						any_primary_culture = {
							has_discrimination_trait = language_dutch
						}
					}
				}
				cu:boer = {
					save_scope_as = main_culture_scope
				}
				scope:target_country = {
					add_primary_culture = cu:boer
				}
			}
		}
		else = {
			ordered_primary_culture = {
				order_by = "root.culture_percent_country(this)"
				save_scope_as = main_culture_scope
			}
			every_primary_culture = { # ROOT's primary cultures
				save_temporary_scope_as = temp_primary_culture
				scope:target_country = {
					add_primary_culture = scope:temp_primary_culture
				}
			}
		}
		scope:target_country = {
			ordered_scope_pop = {
				limit = {
					is_pop_type = bureaucrats
				}
				order_by = total_size
				position = 0
				check_range_bounds = no
				change_pop_culture = {
					target = scope:main_culture_scope
					value = 0.05
				}
			}
			add_modifier = {
				name = modifier_changed_administrative_language
				days = normal_modifier_time
				is_decaying = yes
			}
			capital = {
				add_modifier = {
					name = modifier_changed_administrative_language_state
					days = normal_modifier_time
					is_decaying = yes
				}
			}
		}

		scope:target_country = { #the part I added
			if = {
				limit = { NOT = { religion = root.religion } }

#				ig:ig_devout = {
#					digcf_convert_devout_interest_group = yes #This is also for the Devout IG Conversion Framework
#				}

				if = {
					limit = { has_law_or_variant = law_type:law_state_atheism }
					activate_law = law_type:law_freedom_of_conscience
				}

				digcf_convert_devout_ig = {
					target_country = this
					target_religion = root.religion
				}

				set_state_religion = root.religion
				state_religion_switch_effect = yes

				every_scope_state = {
					convert_population = {
						target = root.religion
						value = 0.05
					}
				}
				
			}
		}
	}

	ai = {
		evaluation_chance = {
			value = 0.25
		}

		propose_score = {
			value = 10
		}

		will_propose = {
			"ai_ideological_opinion(scope:target_country)" <= -25
			OR = {
				scope:target_country = { liberty_desire < define:NDiplomacy|WAR_GOAL_INFAMY_LOW_LIBERTY_DESIRE_THRESHOLD }
				has_attitude = {
					who = scope:target_country
					attitude = domineering
				}
			}
			OR = {
				has_strategy = ai_strategy_maintain_power_balance
				has_strategy = ai_strategy_anti_imperialism
				has_strategy = ai_strategy_world_revolution
			}
		}
	}
}

REPLACE:force_state_religion = { # from 31_power_bloc_force_state_religion in common\diplomatic_actions
	groups= {
		power_bloc_leader
	}
	show_in_lens = no

	texture = "gfx/interface/icons/diplomatic_action_icons/force_state_religion.dds"

	selectable = {
		is_power_bloc_leader = yes
		power_bloc ?= {
			modifier:power_bloc_leader_can_force_state_religion_bool = yes
		}
	}

	potential = {
		power_bloc ?= {
			scope:target_country.power_bloc ?= this
		}
	}

	possible = {
		scope:target_country = {
			NOT = { religion = root.religion }
		}

		power_bloc = {
			current_cohesion_percentage >= 0.5
		}
		scope:target_country = {
			tenure_in_current_power_bloc_years >= 5
		}
		prestige >= {
			value = scope:target_country.prestige
			multiply = 3
		}
	}

	accept_effect = {
		scope:target_country = {
			if = {
				limit = { has_law_or_variant = law_type:law_state_atheism }
				activate_law = law_type:law_freedom_of_conscience
			}

			digcf_convert_devout_ig = {
				target_country = this
				target_religion = root.religion
			}

			set_state_religion = root.religion
			state_religion_switch_effect = yes

			capital = {
				convert_population = {
					target = root.religion
					value = 0.05
				}
			}
			every_scope_state = {
				limit = { is_capital = no }
				convert_population = {
					target = root.religion
					value = 0.02
				}
			}
		}

		power_bloc = {
			add_cohesion_percent = scaled_cohesion_cost
		}
	}

	ai = {
		evaluation_chance = {
			value = 0.025 # AI shouldn't use this very often
		}

		will_propose = {
			power_bloc = { current_cohesion_percentage >= 0.75 }
			OR = {
				has_attitude = {
					who = scope:target_country
					attitude = domineering
				}
				AND = {
					religion = { has_discrimination_trait = heritage_christian }
					NOT = { scope:target_country = { religion = { has_discrimination_trait = heritage_christian } } }
				}
				AND = {
					religion = { has_discrimination_trait = heritage_islamic }
					NOT = { scope:target_country = { religion = { has_discrimination_trait = heritage_islamic } } }
				}
				AND = {
					religion = { has_discrimination_trait = heritage_jewish }
					NOT = { scope:target_country = { religion = { has_discrimination_trait = heritage_jewish } } }
				}
				AND = {
					religion = { has_discrimination_trait = heritage_taoic }
					NOT = { scope:target_country = { religion = { has_discrimination_trait = heritage_taoic } } }
				}
				AND = {
					religion = { has_discrimination_trait = heritage_dharmic }
					NOT = { scope:target_country = { religion = { has_discrimination_trait = heritage_dharmic } } }
				}
				AND = {
					religion = { has_discrimination_trait = heritage_indigenous }
					NOT = { scope:target_country = { religion = { has_discrimination_trait = heritage_indigenous } } }
				}
			}
		}

		propose_score = {
			value = 10
		}
	}
}

